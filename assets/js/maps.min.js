!function(t,a,e,i){"use strict";var o=function(t){this.options=t};o.prototype.create_element=function(t,a,i){t.className="wpomp-control-outer";var o=e.createElement("div");o.className="wpomp-control-inner",t.appendChild(o);var n=e.createElement("div");n.className="wpomp-control-content",n.innerHTML=i,o.appendChild(n)};var n=function(a,e){var i;this.element=a,e=JSON.parse(atob(e)),this.map_data=t.extend({},{},e),i=this.map_data.map_options,this.settings=t.extend({min_zoom:"0",max_zoom:"19",zoom:"5",map_type_id:"mapbox.streets",scroll_wheel:!0,map_visual_refresh:!1,full_screen_control:!1,full_screen_control_position:"bottomright",zoom_control:!0,zoom_control_style:"SMALL",zoom_control_position:"topleft",map_type_control:!0,map_type_control_style:"HORIZONTAL_BAR",map_type_control_position:"topright",scale_control:!0,overview_map_control:!0,center_lat:"40.6153983",center_lng:"-74.2535216",draggable:!0,gesture:"auto",infowindow_open_event:"click",map_data_provider:"openstreet",map_tile_url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",search_control:!1,locateme_control:!1,map_type_control:!1},{},i),this.container=t("div[rel='"+t(this.element).attr("id")+"']"),this.places=[],this.show_places=[],this.categories={},this.tabs=[],this.per_page_value=0,this.last_remove_cat_id="",this.last_selected_cat_id="",this.last_category_chkbox_action="",this.search_area="",this.url_filters=[],this.mbAttr='Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',this.mbURL="",this.isMobile=!1,this.bingmaplayers={},this.infowindow_marker=L.popup({closeOnClick:!0===this.settings.close_infowindow_on_map_click}),this.init()};n.prototype={init:function(){var n=this;n.map_data.map_property&&1==n.map_data.map_property.debug_mode&&(console.log("*********wpomp Debug Mode Output*********"),console.log("Map ID ="+n.map_data.map_property.map_id),n.map_data.places&&console.log("Total Locations="+n.map_data.places.length),console.log("wpomp Object="),console.log(n.map_data),console.log("*********wpomp Debug Mode End Output*********"));var r="desktop",c=t(a).width();c<=480?r="smartphones":c>480&&c<=768?r="ipads":c>=1824&&(r="large-screens"),"desktop"!=r&&1==n.settings.mobile_specific&&(!0,n.isMobile=!0,n.settings.screens&&n.settings.screens[r]?(n.settings.width_mobile=n.settings.screens[r].map_width_mobile,n.settings.height_mobile=n.settings.screens[r].map_height_mobile,n.settings.zoom=parseInt(n.settings.screens[r].map_zoom_level_mobile),n.settings.draggable="false"!==n.settings.screens[r].map_draggable_mobile,n.settings.scroll_wheel="false"!==n.settings.screens[r].map_scrolling_wheel_mobile):(n.settings.width_mobile="",n.settings.height_mobile=""),""!=n.settings.width_mobile&&t(n.element).css("width",n.settings.width_mobile),""!=n.settings.height_mobile&&t(n.element).css("height",n.settings.height_mobile));var s={center:new L.LatLng(n.settings.center_lat,n.settings.center_lng),zoom:parseInt(n.settings.zoom),minZoom:parseInt(n.settings.min_zoom),maxZoom:parseInt(n.settings.max_zoom),scrollWheelZoom:n.settings.scroll_wheel,doubleClickZoom:!0===n.settings.doubleclickzoom,dragging:n.settings.draggable,zoomControl:!1,attributionControl:n.settings.attribution_screen_control,closePopupOnClick:!0===this.settings.close_infowindow_on_map_click};if(n.mbURL="https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token="+wpomp_local.accesstoken,"mapbox"==n.settings.map_data_provider)n.map=L.map(n.element,s),L.tileLayer(n.mbURL,{attribution:n.mbAttr,maxZoom:parseInt(n.settings.max_zoom),id:n.settings.map_type_id,accessToken:wpomp_local.accesstoken}).addTo(n.map);else if("mapquest"==n.settings.map_data_provider){var _={layers:[MQ.mapLayer()]},l=L.Util.extend({},s,_);n.map=L.map(n.element,l);L.control.attribution({prefix:!1}).addTo(n.map).addAttribution('<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>; \r\n© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors')}else if("bingmap"==n.settings.map_data_provider){n.map=L.map(n.element,s);var p={key:wpomp_local.wpomp_bingmap_key,detectRetina:!0},d={};["Aerial","AerialWithLabelsOnDemand","RoadOnDemand","CanvasDark","CanvasLight","CanvasGray"].forEach((function(t){d[t]=L.bingLayer(L.extend({imagerySet:t},p))})),n.bingmaplayers=d,d.CanvasGray.addTo(n.map)}else n.map=L.map(n.element,s),L.tileLayer(n.settings.map_tile_url,{maxZoom:parseInt(n.settings.max_zoom)}).addTo(n.map);if(n.settings.scale_control&&L.control.scale({position:"bottomleft"}).addTo(n.map),!0===n.settings.zoom_control&&L.control.zoom({position:n.settings.zoom_control_position}).addTo(n.map),"edit_location"==n.map_data.page&&setTimeout((function(){map.invalidateSize(!0)}),300),!0===n.settings.locateme_control)L.control.locate({strings:{title:"Show me where I am, yo!",popup:'<div class="wpomp_infowindow"><div class="wpomp_iw_content">You are within {distance} {unit} from this point</div></div>'},icon:"wpomp_locateme_control",drawCircle:!1,position:n.settings.locateme_control_position}).addTo(n.map);if(!0===n.settings.full_screen_control&&n.map.addControl(new L.Control.Fullscreen({position:n.settings.full_screen_control_position})),n.settings.map_type_control){var m=n.settings.openstreet_styles_markup;if("mapbox"==n.settings.map_data_provider&&(m=n.settings.map_box_styles_markup),"mapquest"==n.settings.map_data_provider&&(m=n.settings.mapquest_styles_markup),"bingmap"==n.settings.map_data_provider&&(m=n.settings.binmaps_styles_markup),n.map.addControl(new(L.Control.extend({options:{position:n.settings.map_type_control_position},onAdd:function(t){var a=L.DomUtil.create("div","info legend");return a.innerHTML=m,a.firstChild.onmousedown=a.firstChild.ondblclick=L.DomEvent.stopPropagation,a}}))),t(e).on("change","select.wpomp_map_type",(function(){var a=t(this).val(),e=n.settings.openstreet_styles[a];L.tileLayer(e,{maxZoom:parseInt(n.settings.max_zoom)}).addTo(n.map)})),t(e).on("change","select.wpomp_mapbox_type",(function(){var a="https://api.mapbox.com/styles/v1/mapbox/"+t(this).val()+"/tiles/{z}/{x}/{y}?access_token="+wpomp_local.accesstoken;L.tileLayer(a,{maxZoom:parseInt(n.settings.max_zoom)}).addTo(n.map)})),"mapquest"==n.settings.map_data_provider){var g={Map:MQ.mapLayer(),Hybrid:MQ.hybridLayer(),Satellite:MQ.satelliteLayer(),Dark:MQ.darkLayer(),Light:MQ.lightLayer()};t(e).on("change","select.wpomp_mapquest_type",(function(){var a=t(this).val(),e=g[a];n.map.addLayer(e)}))}"bingmap"==n.settings.map_data_provider&&t(e).on("change","select.wpomp_bingmap_type",(function(){var a=t(this).val(),e=n.bingmaplayers[a];n.map.addLayer(e)}))}if(n.settings.search_control&&n.map.addControl(new(L.Control.extend({options:{position:n.settings.search_control_position},onAdd:function(t){var a=L.DomUtil.create("div","info legend");return a.innerHTML='<div><input type="text"  name="wpomp_map_suggest" id="wpomp_map_suggest'+n.map_data.map_property.map_id+'" class="wpomp_map_suggest" placeholder="'+wpomp_local.autocomplete_placeholder+'" ></div>',a}}))),n.map_loaded(),n.responsive_map(),n.create_markers(),n.display_markers(),void 0!==n.settings.google_fonts&&n.load_google_fonts(n.settings.google_fonts),1==n.settings.map_control&&void 0!==n.settings.map_control_settings){var f=new o;t.each(n.settings.map_control_settings,(function(t,a){L.Control.Watermark=L.Control.extend({onAdd:function(t){var i=e.createElement("div");return f.create_element(i,n.map,a.html),i.index=1,i},onRemove:function(t){}}),L.control.watermark=function(t){return new L.Control.Watermark(t)},L.control.watermark({position:"bottomleft"}).addTo(n.map)}))}if(1==n.settings.search_control&&n.show_search_control(),n.map_data.listing){if(n.map_data.listing.default_sorting){var u="";"listorder"==n.map_data.listing.default_sorting.orderby&&(u="num"),n.sorting(n.map_data.listing.default_sorting.orderby,n.map_data.listing.default_sorting.inorder,u)}}else n.map_data.map_tabs!==i&&"undefined"!=n.map_data.map_tabs&&typeof n.map_data.map_tabs.category_tab!==i&&"undefined"!==n.map_data.map_tabs.category_tab&&typeof n.map_data.map_tabs.category_tab.cat_tab!==i&&n.map_data.map_tabs.category_tab.cat_tab&&(n.map_data.map_tabs.category_tab.cat_post_order===i&&(n.map_data.map_tabs.category_tab.cat_post_order="asc"),n.sorting("title",n.map_data.map_tabs.category_tab.cat_post_order));n.map_data.listing&&(t(n.container).on("click",".categories_filter_reset_btn",(function(){t(n.container).find(".wpomp_filter_wrappers select").each((function(){t(this).find("option:first").attr("selected","selected"),t(this).find("option:first").prop("selected","selected")})),t(".wpomp_search_input").val(""),n.update_filters()})),t(n.container).on("change",'[data-filter="dropdown"]',(function(){n.update_filters()})),t(n.container).on("click",'[data-filter="checklist"]',(function(){n.update_filters()})),t(n.container).on("click",'[data-filter="list"]',(function(){t(this).hasClass("fc_selected")?t(this).removeClass("fc_selected"):t(this).addClass("fc_selected"),n.update_filters()})),n.display_filters_listing(),n.custom_filters(),t.each(n.map_data.listing.filters,(function(a,e){t(n.container).find('select[name="'+e+'"]').on("change",(function(){n.update_filters()}))})),t(n.container).find('[data-filter="map-sorting"]').on("change",(function(){var a=t(this).val().split("__"),e="";""!==a[0]&&""!==a[1]&&(void 0!==a[2]&&(e=a[2]),n.sorting(a[0],a[1],e),n.update_places_listing())})),t(n.container).find('[data-name="radius"]').on("change",(function(){var a=t(n.container).find('[data-input="wpomp-search-text"]').val();a.length>=2&&""!=t(this).val()?t.get(location.protocol+"//nominatim.openstreetmap.org/search?format=json&q="+a,(function(t){if(Object.keys(t).length>0){var a=new L.LatLng(t[0].lat,t[0].lon);n.search_area=a,n.update_filters()}})):(n.search_area="",n.update_filters())})),t(n.container).find('[data-filter="map-perpage-location-sorting"]').on("change",(function(){n.per_page_value=t(this).val(),n.update_filters()})),t(n.container).find('[data-input="wpomp-search-text"]').on("keyup",(function(){var a=t(this).val();t(n.container).find('[data-filter="map-radius"]').val(""),n.search_area="",a.length>=2&&1==n.map_data.listing.apply_default_radius?a.length>=2&&n.update_filters():n.update_filters()})),t(n.container).find(".location_pagination"+n.map_data.map_property.map_id).pagination(n.show_places.length,{callback:n.display_places_listing,map_data:n,items_per_page:n.map_data.listing.pagination.listing_per_page,prev_text:wpomp_local.prev,next_text:wpomp_local.next})),t(this.container).on("click",".wpomp_locateme_control",(function(){n.get_current_location((function(t){n.map.setCenter(t),n.map_center_marker&&n.map_center_marker.setPosition(t),n.set_center_circle&&n.set_center_circle.setCenter(t)}))})),void 0!==n.map_data.geojson&&n.load_json(n.map_data.geojson),t("body").on("click",".wpomp_marker_link",(function(){t("html, body").animate({scrollTop:t(n.container).offset().top-150},500),n.open_infowindow(t(this).data("marker"),t(this).data("source"))})),t(n.container).on("click",".wpomp_locations a[data-marker]",(function(){var a=this;t("html, body").animate({scrollTop:t(n.container).offset().top-150},500),t.each(n.map_data.places,(function(e,i){if(parseInt(i.id)==parseInt(t(a).data("marker"))&&i.source==t(a).data("source"))return n.map.panTo(i.marker.getLatLng()),!1})),setTimeout((function(){n.open_infowindow(t(a).data("marker"),t(a).data("source"))}),600)})),t(n.container).on("click",".wpomp_location_container a[data-marker]",(function(){n.open_infowindow(t(this).data("marker"),t(this).data("source"))})),n.google_auto_suggest(t(".wpomp_auto_suggest")),!0===n.settings.fit_bounds&&n.fit_bounds(),!0===n.settings.url_filters&&n.apply_url_filters(),void 0!==n.map_data.map_tabs&&(this.map_widgets(),t(n.container).find(".wpomp_toggle_main_container").find("div[id^='wpomp_tab_']").css("display","none"),n.settings.infowindow_filter_only!==i&&!1!==n.settings.infowindow_filter_only||(t(n.container).find("input[data-marker-category]").attr("checked",!0),t(n.container).find("input[data-marker-location]").attr("checked",!0),t(n.container).find("input[data-marker-category]").prop("checked",!0),t(n.container).find("input[data-marker-location]").prop("checked",!0)),void 0!==n.map_data.map_tabs&&this.map_data.map_tabs.category_tab&&!0===this.map_data.map_tabs.category_tab.select_all&&t(n.container).find('input[name="wpomp_select_all"]').click((function(){t(this).is(":checked")?(t(n.container).find("input[data-marker-category]").attr("checked",!0),t(n.container).find("input[data-marker-location]").attr("checked",!0),t(n.container).find("input[data-marker-category]").prop("checked",!0),t(n.container).find("input[data-marker-location]").prop("checked",!0)):(t(n.container).find("input[data-marker-category]").attr("checked",!1),t(n.container).find("input[data-marker-location]").attr("checked",!1),t(n.container).find("input[data-marker-category]").prop("checked",!1),t(n.container).find("input[data-marker-location]").prop("checked",!1)),n.update_filters()})),t(n.container).on("click",".wpomp_toggle_container",(function(){t(n.container).find(".wpomp_toggle_main_container").slideToggle("slow"),t(this).text()==wpomp_local.hide?t(this).text(wpomp_local.show):t(this).text(wpomp_local.hide)})),void 0!==n.map_data.map_tabs&&!0===n.map_data.map_tabs.hide_tabs_default&&t(n.container).find(".wpomp_toggle_container").trigger("click"),t(n.container).find(".wpomp_specific_route_item").attr("checked",!0),t(n.container).find(".wpomp_toggle_main_container").find("div[id^='wpomp_tab_']").first().css("display","block"),t(n.container).on("click","li[class^='wpomp-tab-'] a",(function(){t(n.container).find("li[class^='wpomp-tab-'] a").removeClass("active"),t(this).addClass("active"),t(n.container).find(".wpomp_toggle_main_container").find("div[id^='wpomp_tab_']").css("display","none"),t(n.container).find(".wpomp_toggle_main_container").find("#wpomp_tab_"+t(this).parent().attr("rel")).css("display","block")})),t(n.container).on("change","input[data-marker-category]",(function(){var a=t(this).data("marker-category"),e=this;if(t(e).data("child-cats")){var i=t(e).data("child-cats").toString();if(-1!==i.indexOf(","))var o=i.split(",");else(o=[]).push(i)}!1===t(this).is(":checked")?(n.last_remove_cat_id=a,n.last_category_chkbox_action="unchecked",t(e).closest('[data-container="wpomp-category-tab-item"]').find("input[data-marker-location]").attr("checked",!1),t(e).closest('[data-container="wpomp-category-tab-item"]').find("input[data-marker-location]").prop("checked",!1),o&&t.each(o,(function(a,i){t(e).parent().parent().find('[data-marker-category="'+i+'"]').attr("checked",!1),t(e).parent().parent().find('[data-marker-category="'+i+'"]').parent().find("input[data-marker-location]").attr("checked",!1),t(e).parent().parent().find('[data-marker-category="'+i+'"]').prop("checked",!1),t(e).parent().parent().find('[data-marker-category="'+i+'"]').parent().find("input[data-marker-location]").prop("checked",!1)}))):(n.last_selected_cat_id=a,n.last_category_chkbox_action="checked",t(e).closest('[data-container="wpomp-category-tab-item"]').find("input[data-marker-location]").attr("checked",!0),t(e).closest('[data-container="wpomp-category-tab-item"]').find("input[data-marker-location]").prop("checked",!0),o&&t.each(o,(function(a,i){t(e).parent().parent().find('[data-marker-category="'+i+'"]').attr("checked",!0),t(e).parent().parent().find('[data-marker-category="'+i+'"]').parent().find("input[data-marker-location]").attr("checked",!0),t(e).parent().parent().find('[data-marker-category="'+i+'"]').prop("checked",!0),t(e).parent().parent().find('[data-marker-category="'+i+'"]').parent().find("input[data-marker-location]").prop("checked",!0)}))),n.update_filters(),void 0!==n.map_data.places&&t.each(n.map_data.places,(function(t,a){n.get_updated_icon_image(a)}))})),t(n.container).on("change","input[data-marker-location]",(function(){n.update_filters()}))),t(n.container).find(".wpomp-accordion").accordion({speed:"slow"})},load_google_fonts:function(a){a&&a.length>0&&t.each(a,(function(t,a){a.indexOf(",")>=0&&(a=(a=a.split(","))[0]),a.indexOf('"')>=0&&(a=(a=a.replace('"',"")).replace('"',"")),WebFont.load({google:{families:[a]}})}))},get_updated_icon_image:function(a){var e=this;if((""!=e.last_remove_cat_id||""!=e.last_selected_cat_id)&&a.categories&&parseInt(a.categories.length)>1)if("unchecked"==e.last_category_chkbox_action){var i=parseInt(e.last_remove_cat_id);t.each(e.map_data.marker_category_icons,(function(t,e){if(t!=i){var o=L.icon({iconUrl:e,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-55]});return a.marker.setIcon(o),!1}}))}else{i=e.last_selected_cat_id;t.each(e.map_data.marker_category_icons,(function(t,e){if(t==i){var o=L.icon({iconUrl:e,iconSize:[32,32],iconAnchor:[16,32]});return a.marker.setIcon(o),!1}}))}},map_widgets:function(){var a="";this.map_data.map_tabs.category_tab&&!0===this.map_data.map_tabs.category_tab.cat_tab&&this.widget_category(),"undefined"!=(a+=this.show_tabs())&&t(this.container).find(".wpomp_map_parent").append(a)},widget_category:function(){var a=this;if(!0===a.map_data.map_tabs.category_tab.select_all)var e='<div class="wpomp-select-all"><input checked="checked" type="checkbox" value="true" name="wpomp_select_all">&nbsp&nbsp'+wpomp_local.select_all+"</div>";else e="";var o={},n={};void 0!==a.map_data.places&&t.each(a.map_data.places,(function(e,r){void 0!==r.categories&&t.each(r.categories,(function(t,e){var c=!0,s="";if(void 0!==a.map_data.map_tabs&&(s=a.search_category(a.map_data.map_tabs.category_tab.child_cats,e.id,[],o,n)),s.length>0&&(c=!1),void 0!==e.type&&"category"==e.type&&e.name&&1==c){void 0===o[e.id]&&(o[e.id]={},o[e.id].data=[]),o[e.id].cat_id=e.id,o[e.id].cat_title=e.name,o[e.id].cat_marker_icon=e.icon,e.extension_fields&&e.extension_fields.cat_order&&(o[e.id].cat_order=e.extension_fields.cat_order);var _="";r.location.redirect_permalink&&(_=r.location.redirect_permalink);var l="";r.location.redirect_custom_link&&(l=r.location.redirect_custom_link),o[e.id].data.push({cat_location_id:r.id,cat_location_title:r.title,cat_location_address:r.address,cat_location_zoom:r.location.zoom,onclick_action:r.location.onclick_action,redirect_permalink:_,redirect_custom_link:l,source:r.source})}else if(void 0!==e.type&&"category"==e.type&&e.name&&0==c){void 0===n[e.id]&&(n[e.id]={},n[e.id].data=[],n[e.id].parent_cat=s),n[e.id].cat_id=e.id,n[e.id].cat_title=e.name,n[e.id].cat_marker_icon=e.icon,e.extension_fields&&e.extension_fields.cat_order&&(n[e.id].cat_order=e.extension_fields.cat_order);_="";r.location.redirect_permalink&&(_=r.location.redirect_permalink);l="";r.location.redirect_custom_link&&(l=r.location.redirect_custom_link),n[e.id].data.push({cat_location_id:r.id,cat_location_title:r.title,cat_location_address:r.address,cat_location_zoom:r.location.zoom,onclick_action:r.location.onclick_action,redirect_permalink:_,redirect_custom_link:l,source:r.source}),o[s]!==i&&(void 0===o[s].child_cats&&(o[s].child_cats=[]),o[s].child_cats[e.id]=e.id)}}))}));var r=[];void 0!==o&&t.each(o,(function(e,i){var o=i.data.length;void 0!==n&&t.each(n,(function(a,e){e.parent_cat==i.cat_id&&(o+=e.data.length,t.each(n,(function(t,a){a.parent_cat==e.cat_id&&(o+=a.data.length)})))})),i.loc_count=o,"count"==a.map_data.map_tabs.category_tab.cat_order_by?r.push(i.loc_count):"category"==a.map_data.map_tabs.category_tab.cat_order_by?i.cat_order?r.push(i.cat_order):!i.cat_order&&a.map_data.map_tabs.category_tab.all_cats[i.cat_id]&&a.map_data.map_tabs.category_tab.all_cats[i.cat_id].extensions_fields&&(i.cat_order=a.map_data.map_tabs.category_tab.all_cats[i.cat_id].extensions_fields.cat_order,r.push(i.cat_order)):i.cat_title?r.push(i.cat_title):!i.cat_title&&a.map_data.map_tabs.category_tab.all_cats[i.cat_id]&&(i.cat_title=a.map_data.map_tabs.category_tab.all_cats[i.cat_id].group_map_title,r.push(i.cat_title))})),void 0!==a.map_data.map_tabs&&"category"==a.map_data.map_tabs.category_tab.cat_order_by?r.sort((function(t,a){return t-a})):void 0!==a.map_data.map_tabs&&"count"==a.map_data.map_tabs.category_tab.cat_order_by?r.sort((function(t,a){return a-t})):r.sort();var c=[],s=[];t.each(r,(function(e,i){t.each(o,(function(e,o){var n;n="count"==a.map_data.map_tabs.category_tab.cat_order_by?o.loc_count:"category"==a.map_data.map_tabs.category_tab.cat_order_by?o.cat_order:o.cat_title,i==n&&-1==t.inArray(o.cat_id,s)&&(c.push(o),s.push(o.cat_id))}))})),void 0!==c&&t.each(c,(function(o,r){var c="";if(!r.cat_title&&a.map_data.map_tabs.category_tab.all_cats[r.cat_id]&&(r.cat_title=a.map_data.map_tabs.category_tab.all_cats[r.cat_id].group_map_title),!r.cat_marker_icon&&a.map_data.map_tabs.category_tab.all_cats[r.cat_id]&&(r.cat_marker_icon=a.map_data.map_tabs.category_tab.all_cats[r.cat_id].group_marker),void 0!==r.cat_marker_icon&&(c='<span class="arrow"><img src="'+r.cat_marker_icon+'"></span>'),e+='<div class="wpomp_tab_item" data-container="wpomp-category-tab-item">',r.child_cats!==i){r.child_cats=r.child_cats.filter((function(t){return""!==t}));var s=' data-child-cats="'+r.child_cats.join(",")+'"'}else s="";e+='<input type="checkbox"'+s+' data-marker-category="'+r.cat_id+'" value="'+r.cat_id+'">';var _=r.loc_count;t.each(a.map_data.map_tabs.category_tab.child_cats,(function(t,a){a==r.cat_id&&0==_&&(_="")}));var l="";if(!0===a.map_data.map_tabs.category_tab.show_count&&""!=_&&(l=" ("+_+")"),e+='<a href="javascript:void(0);" class="wpomp_cat_title wpomp-accordion accordion-close">'+r.cat_title+l+c+"</a>",!0!==a.map_data.map_tabs.category_tab.hide_location&&(e+='<div class="scroll-pane" style="max-height:300px;width:100%;">',e+='<ul class="wpomp_location_container">',t.each(r.data,(function(t,a){"marker"==a.onclick_action?e+='<li><input type="checkbox" data-marker-location="'+a.cat_location_id+'"  value="'+a.cat_location_id+'" /><a data-source="'+a.source+'" data-marker="'+a.cat_location_id+'" data-zoom="'+a.cat_location_zoom+'" href="javascript:void(0);">'+a.cat_location_title+"</a></li>":"post"==a.onclick_action?e+='<li><input type="checkbox" data-marker-location="'+a.cat_location_id+'"  value="'+a.cat_location_id+'" /><a href="'+a.redirect_permalink+'" target="_blank">'+a.cat_location_title+"</a></li>":"custom_link"==a.onclick_action&&(e+='<li><input type="checkbox" data-marker-location="'+a.cat_location_id+'"  value="'+a.cat_location_id+'" /><a href="'+a.redirect_custom_link+'" target="_blank">'+a.cat_location_title+"</a></li>")})),e+="</ul>",e+="</div>"),e+="</div>",void 0!==n){e+=a.display_sub_categories(n,r.cat_id,"",20)}})),void 0!==a.map_data.map_tabs&&a.add_tab(a.map_data.map_tabs.category_tab.cat_tab_title,e)},add_tab:function(t,a){var e=[];e.title=t,e.content=a,this.tabs.push(e)},search_category:function(a,e,i,o,n){var r=this,c=!0;return t.each(a,(function(a,s){a==e&&(i=s,c=!1,void 0===n[e]&&(n[e]={},n[e].data=[],n[e].parent_cat=s,n[e].cat_id=e,t.each(r.categories,(function(t,a){a.group_map_id==e&&(n[e].cat_title=a.group_map_title,n[e].cat_marker_icon=a.group_marker)}))),i=r.search_category(r.map_data.map_tabs.category_tab.child_cats,s,i,o,n))})),1==c&&void 0===o[e]&&(o[e]={},o[e].data=[],o[e].cat_id=e,t.each(r.categories,(function(t,a){a.group_map_id==e&&(o[e].cat_title=a.group_map_title,o[e].cat_marker_icon=a.group_marker)}))),i},show_tabs:function(){if(!(0===this.tabs.length||this.map_data.listing&&1==this.map_data.listing.hide_map)){var a='<div class="wpomp_tabs_container cleanslate"><ul class="wpomp_tabs clearfix">';return t.each(this.tabs,(function(t,e){a+=0==t?'<li class="wpomp-tab-'+t+'" rel="'+t+'"><a class="active" href="javascript:void(0);">'+e.title+"</a></li>":'<li class="wpomp-tab-'+t+'" rel="'+t+'"><a href="javascript:void(0);">'+e.title+"</a></li>"})),a+="</ul>",a+='<div class="wpomp_toggle_main_container">',t.each(this.tabs,(function(t,e){a+='<div id="wpomp_tab_'+t+'">',a+=e.content,a+="</div>"})),a+='</div><div class="wpomp_toggle_container">'+wpomp_local.hide+"</div></div>"}},load_json:function(t){this.map.data.loadGeoJson(t)},wpomp_within_radius:function(a,e){var i=this,o=t(i.container).find('[data-name="radius"]').val(),n=i.map_data.listing.radius_dimension;1==i.map_data.listing.apply_default_radius&&""==o&&(o=i.map_data.listing.default_radius,n=i.map_data.listing.default_radius_dimension),o="km"==n?1e3*parseInt(o):1609.34*parseInt(o);var r=a.marker.getLatLng();return e.distanceTo(r)<o},marker_bind:function(a){this.event_listener(a,"drag",(function(){var a=this.getLatLng();t(".google_latitude").val(a.lat),t(".google_longitude").val(a.lng)}))},google_auto_suggest:function(a){a=t(".wpomp_auto_suggest");var e=this,i="",o="";wpomp_local.wpomp_country_specific&&1==wpomp_local.wpomp_country_specific&&wpomp_local.wpomp_countries&&null!=wpomp_local.wpomp_countries?(i=wpomp_local.wpomp_countries.join(","),o="https://nominatim.openstreetmap.org/search?countrycodes="+i):o="https://nominatim.openstreetmap.org/search",a.each((function(){var i=t(this).attr("id"),n={geojsonServiceAddress:o,map_obj:e,serachboxID:"#"+i};t(a).parent().GeoJsonAutocomplete(n)}))},display_sub_categories:function(a,e,o,n){var r=this,c=[];void 0!==a&&t.each(a,(function(e,i){var o=i.data.length;void 0!==a&&t.each(a,(function(e,n){n.parent_cat==i.cat_id&&(o+=n.data.length,t.each(a,(function(t,a){a.parent_cat==n.cat_id&&(o+=a.data.length)})))})),i.loc_count=o,"count"==r.map_data.map_tabs.category_tab.cat_order_by?c.push(i.loc_count):"category"==r.map_data.map_tabs.category_tab.cat_order_by?i.cat_order?c.push(i.cat_order):!i.cat_order&&r.map_data.map_tabs.category_tab.all_cats[i.cat_id]&&(i.cat_order=r.map_data.map_tabs.category_tab.all_cats[i.cat_id].extensions_fields.cat_order,c.push(i.cat_order)):i.cat_title?c.push(i.cat_title):!i.cat_title&&r.map_data.map_tabs.category_tab.all_cats[i.cat_id]&&(i.cat_title=r.map_data.map_tabs.category_tab.all_cats[i.cat_id].group_map_title,c.push(i.cat_title))})),"category"==r.map_data.map_tabs.category_tab.cat_order_by?c.sort((function(t,a){return t-a})):"count"==r.map_data.map_tabs.category_tab.cat_order_by?c.sort((function(t,a){return a-t})):c.sort();var s=[],_=[];return t.each(c,(function(e,i){t.each(a,(function(a,e){var o;o="count"==r.map_data.map_tabs.category_tab.cat_order_by?e.loc_count:"category"==r.map_data.map_tabs.category_tab.cat_order_by?e.cat_order:e.cat_title,i==o&&-1==t.inArray(e.cat_id,_)&&(s.push(e),_.push(e.cat_id))}))})),t.each(s,(function(c,s){if(s.parent_cat==e){var _="";if(!s.cat_title&&r.map_data.map_tabs.category_tab.all_cats[s.cat_id]&&(s.cat_title=r.map_data.map_tabs.category_tab.all_cats[s.cat_id].group_map_title),!s.cat_marker_icon&&r.map_data.map_tabs.category_tab.all_cats[s.cat_id]&&(s.cat_marker_icon=r.map_data.map_tabs.category_tab.all_cats[s.cat_id].group_marker),void 0!==s.cat_marker_icon&&(_='<span class="arrow"><img src="'+s.cat_marker_icon+'"></span>'),o+='<div class="wpomp_tab_item" data-container="wpomp-category-tab-item" style="padding-left:'+n+'px;">',r.map_data.map_tabs.category_tab.parent_cats!==i&&r.map_data.map_tabs.category_tab.parent_cats[s.cat_id])var l=' data-child-cats="'+r.map_data.map_tabs.category_tab.parent_cats[s.cat_id].join(",")+'"';else l="";o+='<input type="checkbox"'+l+' data-parent-cat="'+e+'" data-marker-category="'+s.cat_id+'" value="'+s.cat_id+'">';var p=s.loc_count;t.each(r.map_data.map_tabs.category_tab.child_cats,(function(t,a){a==s.cat_id&&0==p&&(p="")}));var d="";d=!0===r.map_data.map_tabs.category_tab.show_count&&""!=p?" ("+p+")":"",o+='<a href="javascript:void(0);" class="wpomp_cat_title wpomp-accordion accordion-close">'+s.cat_title+d+_+"</a>",!0!==r.map_data.map_tabs.category_tab.hide_location&&(o+='<div class="scroll-pane" style="height: 97px; width:100%;">',o+='<ul class="wpomp_location_container">',t.each(s.data,(function(t,a){"marker"==a.onclick_action?o+='<li><input type="checkbox" data-marker-location="'+a.cat_location_id+'"  value="'+a.cat_location_id+'" /><a data-marker="'+a.cat_location_id+'" data-zoom="'+a.cat_location_zoom+'" href="javascript:void(0);">'+a.cat_location_title+"</a></li>":"post"==a.onclick_action?o+='<li><input type="checkbox" data-marker-location="'+a.cat_location_id+'"  value="'+a.cat_location_id+'" /><a href="'+a.redirect_permalink+'" target="_blank">'+a.cat_location_title+"</a></li>":"custom_link"==a.onclick_action&&(o+='<li><input type="checkbox" data-marker-location="'+a.cat_location_id+'"  value="'+a.cat_location_id+'" /><a href="'+a.redirect_custom_link+'" target="_blank">'+a.cat_location_title+"</a></li>")})),o+="</ul>",o+="</div>"),o+="</div>",o+=r.display_sub_categories(a,s.cat_id,"",n+20)}else if(c+1==a.length)return})),o},sorting:function(t,a,e){switch(t){case"category":this.places.sort(this.sortByCategory),this.show_places.sort(this.sortByCategory),"desc"==a&&(this.places.reverse(),this.show_places.reverse());break;case"title":this.map_data.places!==i&&this.map_data.places.sort(this.sortByTitle),this.show_places!==i&&this.show_places.sort(this.sortByTitle),"desc"==a&&(this.map_data.places.reverse(),this.places.reverse(),this.show_places.reverse());break;case"address":this.map_data.places.sort(this.sortByAddress),this.show_places.sort(this.sortByAddress),"desc"==a&&(this.places.reverse(),this.show_places.reverse());break;default:var o=this.map_data.places[0];void 0!==o[t]?(this.map_data.places.sort(this.sortByPlace(t,e)),this.show_places.sort(this.sortByPlace(t,e))):void 0!==o.location[t]?(this.map_data.places.sort(this.sortByLocation(t,e)),this.show_places.sort(this.sortByLocation(t,e))):void 0!==o.location.extra_fields[t]&&(this.map_data.places.sort(this.sortByExtraFields(t,e)),this.show_places.sort(this.sortByExtraFields(t,e))),"desc"==a&&(this.places.reverse(),this.show_places.reverse())}},sortByExtraFields:function(t,a){return function(e,i){if(void 0!==i.location.extra_fields[t]&&void 0!==e.location.extra_fields[t]){if(null==i.location.extra_fields[t]&&(i.location.extra_fields[t]=""),null==e.location.extra_fields[t]&&(e.location.extra_fields[t]=""),"num"==a)var o=parseInt(e.location.extra_fields[t]),n=parseInt(i.location.extra_fields[t]);else o=String(e.location.extra_fields[t]).toLowerCase(),n=String(i.location.extra_fields[t]).toLowerCase();return o<n?-1:o>n?1:0}}},sortByLocation:function(t,a){return function(e,i){if(i.location[t]&&e.location[t]&&e.location[t]&&i.location[t]){var o=String(e.location[t]).toLowerCase(),n=String(i.location[t]).toLowerCase();return"num"==a&&(o=parseInt(o),n=parseInt(n)),o<n?-1:o>n?1:0}}},sortByPlace:function(t,a){return function(e,i){if(i[t]&&e[t]&&e[t]&&i[t]){var o=e[t],n=i[t];if("num"==a)o=parseInt(o),n=parseInt(n);else o=String(o).toLowerCase(),n=String(n).toLowerCase();return o<n?-1:o>n?1:0}}},sortByCategory:function(t,a){if(a.categories[0]&&t.categories[0]&&t.categories[0].name&&a.categories[0].name){var e=String(t.categories[0].name).toLowerCase(),i=String(a.categories[0].name).toLowerCase();return e<i?-1:e>i?1:0}},sortByTitle:function(t,a){var e=String(t.title).toLowerCase(),i=String(a.title).toLowerCase();return e<i?-1:e>i?1:0},sortByValue:function(t,a){var e=String(t).toLowerCase(),i=String(a).toLowerCase();return e<i?-1:e>i?1:0},sortByAddress:function(t,a){var e=String(t.address).toLowerCase(),i=String(a.address).toLowerCase();return e<i?-1:e>i?1:0},update_filters:function(){var a=this,e={},i=t(a.container).find('[data-filter="dropdown"]'),o=t(a.container).find('[data-filter="checklist"]:checked'),n=t(a.container).find('[data-filter="list"].fc_selected');t.each(i,(function(a,i){""!=t(this).val()&&(void 0===e[t(this).data("name")]&&(e[t(this).data("name")]=[]),e[t(this).data("name")].push(t(this).val()))})),t.each(o,(function(a,i){void 0===e[t(this).data("name")]&&(e[t(this).data("name")]=[]),e[t(this).data("name")].push(t(this).val())})),t.each(n,(function(a,i){void 0===e[t(this).data("name")]&&(e[t(this).data("name")]=[]),e[t(this).data("name")].push(t(this).data("value").toString())})),this.apply_filters(e)},apply_url_filters:function(){var a=this,e=location.search.substring(1),i=t.parseParams(e||"");t.isEmptyObject(i)||(a.url_filters=i,t.each(i,(function(e,i){"search"==e&&t(a.container).find('[data-input="wpomp-search-text"]').val(i)})),a.apply_filters({}))},apply_filters:function(a){var e=this,o=!0;e.show_places=[];var n=!1;if(t(e.container).find('[data-input="wpomp-search-text"]').length>0){var r=t(e.container).find('[data-input="wpomp-search-text"]').val();(r=String(r).toLowerCase()).length>0&&(n=!0)}if(e.map_data.map_tabs&&e.map_data.map_tabs.category_tab&&!0===e.map_data.map_tabs.category_tab.cat_tab||t(e.container).find("input[data-marker-category]").length>0){var c=t(e.container).find("input[data-marker-category]:checked"),s=[],_=[];c.length>0&&t.each(c,(function(a,e){s.push(t(e).data("marker-category"));var i=t(e).closest('[data-container="wpomp-category-tab-item"]').find("input[data-marker-location]:not(:checked)");i.length>0&&t.each(i,(function(a,e){_.push(t(e).data("marker-location"))}))}));var l=t(e.container).find('[data-container="wpomp-category-tab-item"]').find("input[data-marker-location]:checked"),p=[];l.length>0&&t.each(l,(function(a,e){p.push(t(e).data("marker-location"))}))}if(void 0!==e.map_data.places&&t.each(e.map_data.places,(function(c,l){if(o=!0,void 0!==a&&t.each(a,(function(a,e){var i=!1;if(t.isArray(e)){if(void 0!==l.categories&&"category"==a&&t.each(l.categories,(function(a,o){t.inArray(o.id,e)>-1&&(i=!0)})),void 0!==l.custom_filters&&t.each(l.custom_filters,(function(o,n){a==o&&(i=!1,t.isArray(n)?t.each(n,(function(a,o){t.inArray(o,e)>-1&&(i=!0)})):n==e.val&&(i=!0))})),void 0!==l[a])t.inArray(l[a],e)>-1&&(i=!0);else if(void 0!==l.location[a])t.inArray(l.location[a],e)>-1&&(i=!0);else if(l.location.extra_fields&&void 0!==l.location.extra_fields[a]){var n=e[0];(l.location.extra_fields[a]&&l.location.extra_fields[a].indexOf(n)>-1||t.inArray(l.location.extra_fields[a],e)>-1)&&(i=!0)}0==i&&(o=!1)}else e.val=""})),!0===n&&!0===o&&(o=l.title!=i&&String(l.title).toLowerCase().indexOf(r)>=0||(l.content!=i&&String(l.content).toLowerCase().indexOf(r)>=0||(String(l.location.lat).toLowerCase().indexOf(r)>=0||(String(l.location.lng).toLowerCase().indexOf(r)>=0||(!!(l.address&&String(l.address).toLowerCase().indexOf(r)>=0)||(!!(l.location.state&&String(l.location.state).toLowerCase().indexOf(r)>=0)||(!!(l.location.country&&String(l.location.country).toLowerCase().indexOf(r)>=0)||(!!(l.location.postal_code&&String(l.location.postal_code).toLowerCase().indexOf(r)>=0)||(!!(l.location.city&&String(l.location.city).toLowerCase().indexOf(r)>=0)||void 0!==e.search_area&&""!=e.search_area&&!0===e.wpomp_within_radius(l,e.search_area))))))))),void 0!==l.location.extra_fields&&t.each(l.location.extra_fields,(function(t,a){a&&(a=a.toString())&&String(a).toLowerCase().indexOf(r)>=0&&(o=!0)}))),(l.categories.length==i||"undefined"==l.categories.length)&&s&&s.length>0&&0==t(e.container).find('input[name="wpomp_select_all"]').is(":checked")&&o&&(o=!1),s&&0!=o&&l.categories.length!=i){var d=!1;0===s.length?void 0!==l.categories&&t.each(l.categories,(function(t,a){""===a.id&&(d=!0)})):void 0!==l.categories&&t.each(l.categories,(function(a,e){if(""===e.id)d=!0;else if(t.inArray(parseInt(e.id),s)>-1){d=!0;var i=L.icon({iconUrl:e.icon,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-55]});l.marker.setIcon(i)}})),0!==_.length&&t.inArray(parseInt(l.id),_)>-1&&(d=!1),o=!1!==d,0!==p.length&&t.inArray(parseInt(l.id),p)>-1&&(o=!0)}l.marker.visible=o,0==o?l.marker.remove():l.marker.addTo(e.map),!0===o&&e.show_places.push(l)})),typeof e.map_data.map_options.bound_map_after_filter!=typeof i&&!0===e.map_data.map_options.bound_map_after_filter){var d=new L.LatLngBounds;if(e.show_places.length>0){for(var m=0;m<e.show_places.length;m++)d.extend(new L.LatLng(parseFloat(e.show_places[m].location.lat),parseFloat(e.show_places[m].location.lng)));e.map.fitBounds(d)}}if(e.map_data.listing){if(t(e.container).find('[data-filter="map-sorting"]').val()){var g=t(e.container).find('[data-filter="map-sorting"]').val().split("__"),f="";""!==g[0]&&""!==g[1]&&(void 0!==g[2]&&(f=g[2]),e.sorting(g[0],g[1],f))}else if(e.map_data.listing.default_sorting){f="";"listorder"==e.map_data.listing.default_sorting.orderby&&(f="num"),e.sorting(e.map_data.listing.default_sorting.orderby,e.map_data.listing.default_sorting.inorder,f)}e.update_places_listing()}},create_perpage_option:function(){var t="";return t+='<select name="map_perpage_location_sorting" data-filter="map-perpage-location-sorting" class="choose_salutation">',t+='<option value="'+this.map_data.listing.pagination.listing_per_page+'">'+wpomp_local.show_locations+"</option>",t+='<option value="25">25</option>',t+='<option value="50">50</option>',t+='<option value="100">100</option>',t+='<option value="200">200</option>',t+='<option value="500">500</option>',t+='<option value="'+this.show_places.length+'">'+wpomp_local.all_location+"</option>",t+="</select>"},create_sorting:function(){var a="";return!0===this.map_data.listing.display_sorting_filter&&(a+='<select name="map_sorting" data-filter="map-sorting"><option value="">'+wpomp_local.sort_by+"</option>",t.each(this.map_data.listing.sorting_options,(function(t,e){a+="<option value='"+t+"'>"+e+"</option>"})),a+="</select>"),a},create_radius:function(){var a="";if(!0===this.map_data.listing.display_radius_filter){a+='<select data-name="radius" name="map_radius"><option value="">'+wpomp_local.select_radius+"</option>";var e=this.map_data.listing.radius_options,o=this.map_data.listing.radius_dimension;e!=i&&t.each(e.split(","),(function(t,e){a+="miles"==o?"<option value='"+e+"'>"+e+" "+wpomp_local.miles+"</option>":"<option value='"+e+"'>"+e+" "+wpomp_local.km+"</option>"})),a+="</select>"}return a},custom_filters:function(){var a=this,e=this.map_data.places,i=this.map_data.filters;void 0!==i&&void 0!==i.custom_filters&&0!=i.custom_filters.length&&t.each(i.custom_filters,(function(o,n){var r="",c={};t.each(n,(function(o,n){t.each(n,(function(a,o){t.each(e,(function(e,o){if("category"==a)void 0===o.categories&&(o.categories={}),t.each(o.categories,(function(t,a){void 0===c[a.type]&&(c[a.type]={}),a.name&&(c[a.type][a.name]=a.id)}));else{if(void 0!==o[a]&&(void 0===c[a]&&(c[a]={}),o[a]&&(c[a][o[a]]=o[a])),void 0!==o.location.extra_fields[a]&&(void 0===c[a]&&(c[a]={}),o.location.extra_fields[a]&&(c[a][o.location.extra_fields[a]]=o.location.extra_fields[a])),void 0!==o.location[a]&&(void 0===c[a]&&(c[a]={}),o.location[a]&&(c[a][o.location[a]]=o.location[a])),void 0!==o.custom_filters&&void 0!==o.custom_filters[a]&&(void 0===c[a]&&(c[a]={}),o.custom_filters[a])){var n=o.custom_filters[a];t.isArray(n)?t.each(n,(function(t,e){c[a][e]=e})):c[a][n]=n}if("radius"==a){void 0===c[a]&&(c[a]={});var r=i.radius_options,s=i.radius_dimension;t.each(r.split(","),(function(t,e){"miles"==s?c[a][e+" "+wpomp_local.miles]=e:c[a][e+" "+wpomp_local.km]=e}))}}}))})),"dropdown"==o&&void 0!==c&&t.each(c,(function(e,i){i=a.sort_object_by_value(i),i=a.sort_object_by_unique_values(i),r+='<select data-filter="dropdown"  name="place_'+e+'" data-name = "'+e+'">',r+='<option value="">'+(n[e]?n[e]:"Select "+e)+"</option>",t.each(i,(function(t,a){var e=a;""!=(a=(a=a.replace("'","&#39;")).replace('"',"&#34;"))&&null!=a&&(r+="<option value='"+a+"'>"+e+"</option>")})),r+="</select>"})),"checklist"==o&&void 0!==c&&t.each(c,(function(a,e){r+='<div class="wpomp_filters_checklist">',r+='<label  data-filter = "place_'+a+'" >'+(i.custom_filters[a]?i.custom_filters[a]:"Select "+a)+"</label>",t.each(e,(function(t,e){""!=e&&null!=e&&(r+="<input data-filter='checklist' type='checkbox' data-name = '"+a+"' value='"+e+"'>"+t)})),r+="</div>"})),"list"==o&&void 0!==c&&t.each(c,(function(a,e){r+='<div class="wpomp_filters_list">',r+='<label  data-filter = "place_'+a+'" >'+(i.custom_filters[a]?i.custom_filters[a]:"Select "+a)+"</label><ul>",t.each(e,(function(t,e){""!=e&&null!=e&&(r+="<li data-filter='list' data-name = '"+a+"' data-value='"+e+"'>"+t+"</li>")})),r+="</ul></div>"}))})),t("body").find(i.filters_container).append(r)}))},sort_object_by_keyvalue:function(t,a,e,i){var o=[];for(var n in t)o.push(t[n]);return o.sort(this.sortByPlace(a,e)),"desc"==i&&o.reverse(),o},sort_object_by_unique_values:function(t){var a=[];for(var e in t)t[e].indexOf(",")>-1?t[e].split(/\s*,\s*/).forEach((function(t){a.push(t.trim())})):a.push(t[e].trim());return a.filter((function(t,e){return a.indexOf(t)==e})).sort()},sort_object_by_value:function(t){var a=[];for(var e in t)a.push(e);a.sort(this.sortByValue);for(var i={},o=0;o<a.length;o++)i[a[o]]=t[a[o]];return i},create_filters:function(){var a=this,e={},i=this.map_data.places,o=this.map_data.listing,n=o.display_taxonomies_all_filter;t.each(i,(function(a,i){void 0===i.categories&&(i.categories={}),t.each(i.categories,(function(t,a){void 0===e[a.type]&&(e[a.type]={}),a.name&&(a.extension_fields&&a.extension_fields.cat_order?e[a.type][a.name]={id:a.id,order:a.extension_fields.cat_order,name:a.name}:e[a.type][a.name]={id:a.id,order:0,name:a.name})}))}));var r="",c="name",s="",_="asc";return a.map_data.listing&&a.map_data.listing.default_sorting&&("listorder"==a.map_data.listing.default_sorting.orderby&&(c="order",s="num",_=a.map_data.listing.default_sorting.inorder),_=a.map_data.listing.default_sorting.inorder),t.each(e,(function(e,i){if(!0===o.display_category_filter&&"category"==e)r+='<select data-filter="dropdown" data-name="category" name="place_'+e+'">',r+='<option value="">'+wpomp_local.select_category+"</option>",i=a.sort_object_by_keyvalue(i,c,s,_),t.each(i,(function(t,a){r+="<option value='"+a.id+"'>"+a.name+"</option>"})),r+="</select>";else if(!0===o.display_taxonomies_filter){if(null===n)return!1;n.indexOf(e)>-1&&(r+='<select data-filter="dropdown" data-name="category" name="place_'+e+'">',r+='<option value="">Select '+e+"</option>",t.each(i,(function(t,a){r+="<option value='"+a+"'>"+t+"</option>"})),r+="</select>")}})),r},update_places_listing:function(){var a=this;a.per_page_value>0?a.per_page_value=a.per_page_value:a.per_page_value=a.map_data.listing.pagination.listing_per_page,t(a.container).find(".location_pagination"+a.map_data.map_property.map_id).pagination(a.show_places.length,{callback:a.display_places_listing,map_data:a,items_per_page:a.per_page_value,prev_text:wpomp_local.prev,next_text:wpomp_local.next})},display_filters_listing:function(){if(this.map_data.listing){var a=this.map_data.listing.hide_locations,e=this.map_data.listing.list_grid;if(1!=a){var i='<div class="wpomp_listing_container">';i+="<div class='wpomp_categories wpomp_print_listing "+e+"' data-container='wpomp-listing-"+t(this.element).attr("id")+"'></div>",i+="</div>",t(this.map_data.listing.listing_container).html(i)}this.map_data.listing.filters_position;var o=this.display_filters();"undefined"!==this.map_data.layoutManager&&"true"==this.map_data.layoutManager?t(this.container).find(".wpgmp_filter_wrappers").length>0&&t(this.container).find(".wpgmp_filter_wrappers").html(this.listing_filter_content):t(this.container).find(".wpomp_filter_wrappers").html(o)}},display_filters:function(){var t=this.map_data.listing.hide_locations,a="";if(a+='<div class="wpomp_before_listing">'+this.map_data.listing.listing_header+"</div>",!0===this.map_data.listing.display_search_form){var e="";!0===this.map_data.listing.search_field_autosuggest&&(e="wpomp_auto_suggest"),a+='<div class="wpomp_listing_header"><div class="wpomp_search_form"><input id="searchBox" type="text" rel="24" data-input="wpomp-search-text" name="wpomp_search_input" class="wpomp_search_input '+e+'" placeholder="'+wpomp_local.search_placeholder+'"></div></div>'}return a+='<div class="categories_filter">'+this.create_filters()+'<div data-container="wpomp-filters-container"></div>',1!=t&&(a+=this.create_sorting()+""),1!=t&&!0===this.map_data.listing.display_location_per_page_filter&&(a+=" "+this.create_perpage_option()+" "),a+=" "+this.create_radius()+" ",1!=t&&!0===this.map_data.listing.display_grid_option&&(a+=" "+wpomp_local.img_grid+wpomp_local.img_list),void 0!==this.map_data.map_options.display_reset_button&&!0===this.map_data.map_options.display_reset_button&&(a+='<div class="categories_filter_reset"><input type="button" class="categories_filter_reset_btn" name="categories_filter_reset_btn" value="'+this.map_data.map_options.map_reset_button_text+'"></div>'),a+="</div>"},display_places_listing:function(a,e){var o="",n=this,r=(t('select[name = "place_category"]'),10);r=n.items_per_page?n.items_per_page:n.map_data.map_data.listing.pagination.listing_per_page;var c=n.map_data.show_places,s=n.map_data.map_data.listing.listing_container,_=n.map_data.map_data.listing.listing_placeholder,l=Math.min((a+1)*r,c.length),p="",d="";if(l>0)for(var m=a*r;m<l;m++){var g=c[m],f=_;g.id&&("marker"==g.location.onclick_action?(p='<a href="javascript:void(0);" data-source="'+g.source+'"  class="place_title" data-zoom="'+g.location.zoom+'"  data-marker="'+g.id+'" >'+g.title+"</a>",d='href="javascript:void(0);" data-source="'+g.source+'" data-zoom="'+g.location.zoom+'"  data-marker="'+g.id+'"'):"post"==g.location.onclick_action?(p='<a href="'+g.location.redirect_permalink+'" target="_blank">'+g.title+"</a>",d='href="'+g.location.redirect_permalink+'" target="_blank"'):"custom_link"==g.location.onclick_action?(p='<a href="'+g.location.redirect_custom_link+'" target="_blank">'+g.title+"</a>",d='href="'+g.location.redirect_custom_link+'" target="_blank"'):(p='<a href="javascript:void(0);" class="place_title" data-source="'+g.source+'" data-zoom="'+g.location.zoom+'"  data-marker="'+g.id+'" >'+g.title+"</a>",d='href="javascript:void(0);"data-source="'+g.source+'" data-zoom="'+g.location.zoom+'"  data-marker="'+g.id+'"'));var u=[],h=[],v={};if(g.categories)for(var w=0;w<g.categories.length;w++)if(""!==g.categories[w].icon&&u.push("<img title='"+g.categories[w].name+"' alt='"+g.categories[w].name+"' src='"+g.categories[w].icon+"' />"),"category"==g.categories[w].type&&""!=g.categories[w].name&&h.push(g.categories[w].name),"category"!=g.categories[w].type){if(void 0===g.categories[w].name)continue;if(g.categories[w].name)var y=",";void 0===v[g.categories[w].type]&&(v[g.categories[w].type]=""),v[g.categories[w].type]+=g.categories[w].name+y}var k="";k="post"==g.source?g.location.extra_fields.post_featured_image:g.location.marker_image;var b={"{marker_id}":g.id,"{marker_title}":p,"{marker_address}":g.address,"{marker_latitude}":g.location.lat,"{marker_longitude}":g.location.lng,"{marker_city}":g.location.city,"{marker_state}":g.location.state,"{marker_country}":g.location.country,"{marker_postal_code}":g.location.postal_code,"{marker_zoom}":g.location.zoom,"{marker_icon}":u,"{marker_category}":h.join(", "),"{marker_message}":g.content,"{marker_image}":k,"{marker_featured_image}":k,"{wpomp_listing_html}":g.listing_hook,"{onclick_action}":d};if(void 0!==g.location.extra_fields)for(var x in g.location.extra_fields)g.location.extra_fields[x]?b["{"+x+"}"]=g.location.extra_fields[x]:b["{"+x+"}"]="<div class='wpomp_empty'>wpomp_empty</div>";if(n.map_data.map_data.map_options.link_extra_field!=i&&""!=n.map_data.map_data.map_options.link_extra_field){var L=n.map_data.map_data.map_options.link_extra_field;for(var C in L)"<div class='wpomp_empty'>wpomp_empty</div>"!=b[C]&&""!=C&&(f=f.replace(C,L[C]))}for(var z in b)b[z]!=i&&"undefined"!=b[z]||(b[z]="");if(v)for(var S in v)b["{"+S+"}"]=A(v[S]);var A=function(t){var a=t.lastIndexOf(",");return t.substring(0,a)};o+=f=f.replace(/{[^{}]+}/g,(function(t){return t in b?b[t]:""}))}else o="<div class='wpomp_no_locations'>"+wpomp_local.wpomp_location_no_results+"</div>";o+='<div id="wpomp_pagination"></div>',o='<div class="fc-'+n.map_data.map_data.listing.list_item_skin.type+"-"+n.map_data.map_data.listing.list_item_skin.name+' fc-wait"><div data-page="2" class="fc-component-6" data-layout="'+n.map_data.map_data.listing.list_item_skin.name+'" >'+o+"</div></div>",t(s).find(".wpomp_categories").html(o),t(s).find(".wpomp_extra_field:contains('wpomp_empty')").remove(),t(s).find(".wpomp_empty").prev().remove(),t(s).find(".wpomp_empty").remove();try{var I=t(s).find(".wpomp_listing_grid");if(I){var O=t(I).data("masonry");O&&O.destroy();var j=t(I).imagesLoaded((function(){j.masonry({itemSelector:".wpomp_listing_grid .wpomp_locations",columnWidth:".wpomp_listing_grid .wpomp_locations"})}))}}catch(t){console.log(t)}return!1},open_infowindow:function(a,e){var i=this;t.each(this.map_data.places,(function(t,o){parseInt(o.id)==parseInt(a)&&o.source==e&&i.openInfoWindow(o)}))},event_listener:function(t,a,e){t.on(a,e)},map_loaded:function(){var a=this;a.map.getCenter();!0===a.settings.center_by_nearest?a.center_by_nearest():!0===a.settings.show_center_marker&&a.show_center_marker(),!1===a.settings.center_by_nearest&&!0===a.settings.show_center_circle&&a.show_center_circle(),t("body").on("click",".fc-accordion-tab",(function(){if(t(this).hasClass("active")){t(this).removeClass("active");t(this).next().removeClass("active")}else{t(".fc-accordion-tab").removeClass("active"),t(".fc-accordion dd").removeClass("active"),t(this).addClass("active");t(this).next().addClass("active")}}))},responsive_map:function(){this.map},show_search_control:function(){var a=this,e=t(".wpomp_map_suggest"),i="",o="";wpomp_local.wpomp_country_specific&&1==wpomp_local.wpomp_country_specific&&wpomp_local.wpomp_countries&&null!=wpomp_local.wpomp_countries?(i=wpomp_local.wpomp_countries.join(","),o="https://nominatim.openstreetmap.org/search?countrycodes="+i):o="https://nominatim.openstreetmap.org/search",e.each((function(){var i=t(this).attr("id"),n={geojsonServiceAddress:o,map_obj:a,serachboxID:"#"+i};t(e).parent().GeoJsonAutocomplete(n)}))},fit_bounds:function(){var t=this.map_data.places,a=new L.LatLngBounds;t!==i&&t.forEach((function(t){t.location.lat&&t.location.lng&&a.extend(new L.LatLng(parseFloat(t.location.lat),parseFloat(t.location.lng)))})),this.map.fitBounds(a)},create_markers:function(){var a,e=this,o=e.map_data.places,n=[];t.each(o,(function(t,o){if(o.location.lat&&o.location.lng){void 0===o.categories&&(o.categories={}),void 0===o.location.icon&&(o.location.icon=e.settings.marker_default_icon),o.marker=new L.Marker(new L.LatLng(parseFloat(o.location.lat),parseFloat(o.location.lng)),{icon:L.icon({iconUrl:o.location.icon,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-55]}),draggable:o.location.draggable}),(o.location.infowindow_disable||"manual"!=o.source)&&o.marker.bindPopup(o.content),!0===e.settings.infowindow_filter_only?(o.marker.visible=!1,o.marker.remove()):o.marker.addTo(e.map),"edit_location"==e.map_data.page&&e.marker_bind(o.marker);var r=[];if(void 0!==o.categories)for(var c in o.categories)r.push(o.categories[c].name);var s="",_="";_="post"==o.source?o.location.extra_fields.post_featured_image:o.location.marker_image;var l="",p="fc-infowindow-";if("post"==o.source?(l=e.settings.infowindow_geotags_setting,p="wpomp_infowindow_post fc-item-"+e.settings.infowindow_post_skin.name):(l=e.settings.infowindow_setting,"edit_location"!=e.map_data.page&&e.settings.infowindow_skin&&(p="fc-infowindow-"+e.settings.infowindow_skin.name)),void 0===l&&(l=o.content),a={"{marker_id}":o.id,"{marker_title}":o.title,"{marker_address}":o.address,"{marker_latitude}":o.location.lat,"{marker_longitude}":o.location.lng,"{marker_city}":o.location.city,"{marker_state}":o.location.state,"{marker_country}":o.location.country,"{marker_postal_code}":o.location.postal_code,"{marker_zoom}":o.location.zoom,"{marker_icon}":o.location.icon,"{marker_category}":r.join(", "),"{marker_message}":o.content,"{marker_image}":_},void 0!==o.location.extra_fields)for(var d in o.location.extra_fields)o.location.extra_fields[d]?a["{"+d+"}"]=o.location.extra_fields[d]:a["{"+d+"}"]="<div class='wpomp_empty'></div>";s=""===(s=l=l.replace(/{[^{}]+}/g,(function(t){return t in a&&a[t]!=i?a[t]:""})))?!0===e.settings.map_infowindow_customisations&&!0===e.settings.show_infowindow_header?'<div class="wpomp_infowindow '+p+'"><div class="wpomp_iw_head"><div class="wpomp_iw_head_content">'+o.title+'</div></div><div class="wpomp_iw_content">'+o.content+"</div></div>":'<div class="wpomp_infowindow '+p+'"><div class="wpomp_iw_content">'+o.content+"</div></div>":!0===e.settings.map_infowindow_customisations&&!0===e.settings.show_infowindow_header?'<div class="wpomp_infowindow '+p+'"><div class="wpomp_iw_head"><div class="wpomp_iw_head_content">'+o.title+'</div></div><div class="wpomp_iw_content">'+s+"</div></div>":'<div class="wpomp_infowindow '+p+'"><div class="wpomp_iw_content">'+s+"</div></div>",o.infowindow_data=s,o.infowindow=e.infowindow_marker,(!0===o.location.infowindow_default_open||!0===e.settings.default_infowindow_open)&&e.openInfoWindow(o);var m=e.settings.infowindow_open_event;e.isMobile&&(m="click"),e.event_listener(o.marker,m,(function(){(o.location.infowindow_disable||"manual"!=o.source)&&e.openInfoWindow(o)})),e.places.push(o)}else n.push(t)})),t.each(n,(function(t,a){delete o[n]}))},display_markers:function(){var a=this;a.show_places=[],a.categories=[];for(var e={},i=0;i<a.places.length;i++)!0===a.settings.infowindow_filter_only?a.places[i].marker.remove():a.places[i].marker.addTo(a.map),a.show_places.push(this.places[i]),void 0!==a.places[i].categories&&t.each(a.places[i].categories,(function(t,a){void 0===e[a.name]&&(e[a.name]=a)}));this.categories=e},show_center_circle:function(){var t=this;""==t.settings.center_circle_radius&&(t.settings.center_circle_radius=5);var a=t.map.getCenter();L.circle(a,{fillColor:t.settings.center_circle_fillcolor,fillOpacity:t.settings.center_circle_fillopacity,color:t.settings.center_circle_strokecolor,opacity:t.settings.center_circle_strokeopacity,weight:t.settings.center_circle_strokeweight,radius:1e3*parseInt(t.settings.center_circle_radius)}).addTo(t.map)},show_center_marker:function(){var t=this;t.settings.center_marker_infowindow;var a=t.map.getCenter();t.map_center_marker=new L.Marker(a,{icon:L.icon({iconUrl:t.settings.center_marker_icon,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-30]}),draggable:!0}).addTo(t.map),void 0===t.map_center_info&&(t.map_center_info=t.infowindow_marker),""!=t.settings.center_marker_infowindow&&t.event_listener(t.map_center_marker,"click",(function(){var e="";e=t.settings.center_marker_infowindow!=i?t.settings.center_marker_infowindow:wpomp_local.default_center_msg,t.map_center_info.setContent('<div class="wpomp_infowindow"><div class="wpomp_iw_content">'+e+"</div></div>"),t.map_center_info.setLatLng(a).openOn(t.map)}))},center_by_nearest:function(){var t=this;this.get_current_location((function(a){t.user_location_marker||(t.user_location_marker=new L.Marker(a,{icon:L.icon({iconUrl:t.settings.center_marker_icon,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-30]}),title:wpomp_local.center_location_message}).addTo(t.map)),void 0===t.map_center_info&&(t.map_center_info=t.infowindow_marker),""!=t.settings.center_marker_infowindow&&t.event_listener(t.user_location_marker,"click",(function(){var e="";t.settings.center_marker_infowindow!=i&&(e=t.settings.center_marker_infowindow),t.map_center_info.setContent('<div class="wpomp_infowindow"><div class="wpomp_iw_content">'+e+"</div></div>"),t.map_center_info.setLatLng(a).openOn(t.map)})),t.map.setView(a,t.settings.zoom),!0===t.settings.show_center_circle&&t.show_center_circle(),t.map_data.listing&&1==t.map_data.listing.apply_default_radius&&(t.search_area=a)}),(function(a){t.user_location_marker||(t.user_location_marker=new L.Marker(a,{icon:L.icon({iconUrl:t.settings.center_marker_icon,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-30]}),title:wpomp_local.center_location_message}).addTo(t.map)),void 0===t.map_center_info&&(t.map_center_info=t.infowindow_marker),""!=t.settings.center_marker_infowindow&&t.event_listener(t.user_location_marker,"click",(function(){var e="";t.settings.center_marker_infowindow!=i&&(e=t.settings.center_marker_infowindow),t.map_center_info.setContent('<div class="wpomp_infowindow"><div class="wpomp_iw_content">'+e+"</div></div>"),t.map_center_info.setLatLng(a).openOn(t.map)})),t.map.panTo(a),!0===t.settings.show_center_circle&&t.show_center_circle(),t.map_data.listing&&1==t.map_data.listing.apply_default_radius&&(t.search_area=a)}))},get_current_location:function(t,a){var e=this;void 0===e.user_location?navigator.geolocation.getCurrentPosition((function(a){e.user_location=new L.LatLng(a.coords.latitude,a.coords.longitude),t&&t(e.user_location)}),(function(t){e.user_location=e.map.getCenter(),a&&a(e.user_location)}),{enableHighAccuracy:!0,timeout:5e4,maximumAge:0}):t&&t(e.user_location)},openInfoWindow:function(e){var o=this;"post"==e.source?o.settings.infowindow_post_skin.name:"edit_location"!=o.map_data.page&&o.settings.infowindow_skin&&o.settings.infowindow_skin.name,e.infowindow=e.marker.getPopup(),e.infowindow!=i&&(e.infowindow.setContent(e.infowindow_data),"post"==e.location.onclick_action?"yes"==e.location.open_new_tab?a.open(e.location.redirect_permalink,"_blank"):a.open(e.location.redirect_permalink,"_self"):"custom_link"==e.location.onclick_action?"yes"==e.location.open_new_tab?a.open(e.location.redirect_custom_link,"_blank"):a.open(e.location.redirect_custom_link,"_self"):(e.infowindow.setLatLng(e.marker.getLatLng()).openOn(o.map),void 0!==o.settings.infowindow_click_change_center&&1==o.settings.infowindow_click_change_center&&o.map.panTo(e.marker.getLatLng()),void 0!==o.settings.infowindow_click_change_zoom&&o.settings.infowindow_click_change_zoom>0&&(o.map.setZoom(o.settings.infowindow_click_change_zoom),o.map.panTo(e.marker.getLatLng()))),t(o.container).find(".wpomp_empty").prev().remove(),t(o.container).find(".wpomp_empty").remove())}},t.fn.osm_maps=function(a,e){return this.each((function(i){t.data(this,"wpomp_maps")||t.data(this,"wpomp_maps",new n(this,a,e))})),this}}(jQuery,window,document);